View(reprotox_atc)
str_split(reprotox_atc$FISABIO_YEARS, ',')
step1<-str_split(reprotox_atc$FISABIO_YEARS, ',')
#step 2 get the ranges to individual years
ex<-list(c('2012-2016','2018','2020'))
ex[1]
#step 2 get the ranges to individual years
ex<-list('2012-2016','2018','2020'))
#step 2 get the ranges to individual years
ex<-list('2012-2016','2018','2020')
ex[1]
ex
step1<-as.list(str_split(reprotox_atc$FISABIO_YEARS, ','))
step1
as.list(step1[[269]])
as.list(step1[[204]])
'-'%in%ex[1]
'-'%in%ex[1]
'2'%in%ex[1]
2%in%ex[1]
str_split(ex[2], '-'))
str_split(ex[2], '-')
grepl( '-', ex[2], fixed = TRUE)
grepl( '-', ex[1], fixed = TRUE)
ex<-list('2012-2016','2018','2020')
for i in 1:length (ex){
length (ex)
for i in 1:(length (ex)){
for (i in 1:(length (ex)){
1:(length (ex)
for (i in 1:(length (ex))){
for (i in 1:(length (ex))){
if grepl( '-', ex[i], fixed = TRUE){
for (i in 1:10){
print (i)
}
1:(length (ex))
for (i in 1:10){
print (i)
if i<5{print("small number")}
for (i in 1:10){
print (i)
if (i<5){print("small number")}
}
for (i in 1:(length (ex))){
if (grepl( '-', ex[i], fixed = TRUE)){
startend<-as.list(str_split(ex[i], '-'))
print(startend)
}
}
for (i in 1:(length (ex))){
if (grepl( '-', ex[i], fixed = TRUE)){
startend<-as.list(as.numeric(str_split(ex[i], '-')))
print(startend)
}
}
for (i in 1:(length (ex))){
if (grepl( '-', ex[i], fixed = TRUE)){
startend<-as.list(str_split(ex[i], '-'))
print(as.numeric(startend))
}
}
lapply(startend, as.numeric)
x<-lapply(startend, as.numeric)
x[1]
x<-list(lapply(startend, as.numeric))
x[1]
for (i in 1:(length (ex))){
if (grepl( '-', ex[i], fixed = TRUE)){
startend<-as.list(str_split(ex[i], '-'))
startend<-lapply(startend, as.numeric)
print(startend)
}
}
for (i in 1:(length (ex))){
if (grepl( '-', ex[i], fixed = TRUE)){
startend<-list(str_split(ex[i], '-'))
startend<-lapply(startend, as.numeric)
print(startend)
}
}
for (i in 1:(length (ex))){
if (grepl( '-', ex[i], fixed = TRUE)){
startend<-(str_split(ex[i], '-'))
startend<-lapply(startend, as.numeric)
print(startend)
}
}
startend<-unlist(str_split(ex[i], '-'))
for (i in 1:(length (ex))){
if (grepl( '-', ex[i], fixed = TRUE)){
startend<-unlist(str_split(ex[i], '-'))
startend<-lapply(startend, as.numeric)
print(startend)
}
}
x<-1:5
x
print(range)
for (i in 1:(length (ex))){
if (grepl( '-', ex[i], fixed = TRUE)){
startend<-unlist(str_split(ex[i], '-'))
startend<-lapply(startend, as.numeric)
print(startend)
yearrange<-startend[[1]]:startend[[2]]
print(yearrange)
}
}
for (i in 1:(length (ex))){
years<-NA
if (grepl( '-', ex[i], fixed = TRUE)){
startend<-unlist(str_split(ex[i], '-'))
startend<-lapply(startend, as.numeric)
print(startend)
yearrange<-startend[[1]]:startend[[2]]
print(yearrange)
years<-c(years yearrange)
for (i in 1:(length (ex))){
years<-NA
if (grepl( '-', ex[i], fixed = TRUE)){
startend<-unlist(str_split(ex[i], '-'))
startend<-lapply(startend, as.numeric)
print(startend)
yearrange<-startend[[1]]:startend[[2]]
print(yearrange)
years<-c(years, yearrange)
}else{years<-c(years, ex[i])}
}
years
years<-NA
for (i in 1:(length (ex))){
if (grepl( '-', ex[i], fixed = TRUE)){
startend<-unlist(str_split(ex[i], '-'))
startend<-lapply(startend, as.numeric)
print(startend)
yearrange<-startend[[1]]:startend[[2]]
print(yearrange)
years<-c(years, yearrange)
}else{years<-c(years, ex[i])}
}
years
years<-NA
for (i in 1:(length (ex))){
if (grepl( '-', ex[i], fixed = TRUE)){
startend<-unlist(str_split(ex[i], '-'))
startend<-lapply(startend, as.numeric)
print(startend)
yearrange<-startend[[1]]:startend[[2]]
print(yearrange)
years<-c(years, yearrange)
}else{years<-c(years, as.numeric(ex[i]))}
return(unlist(years))
}
unlist(years)
years<-NA
for (i in 1:(length (ex))){
if (grepl( '-', ex[i], fixed = TRUE)){
startend<-unlist(str_split(ex[i], '-'))
startend<-lapply(startend, as.numeric)
yearrange<-startend[[1]]:startend[[2]]
years<-c(years, yearrange)
}else{years<-c(years, as.numeric(ex[i]))}
return(unlist(years))
}
years<-numeric()
for (i in 1:(length (ex))){
if (grepl( '-', ex[i], fixed = TRUE)){
startend<-unlist(str_split(ex[i], '-'))
startend<-lapply(startend, as.numeric)
yearrange<-startend[[1]]:startend[[2]]
years<-c(years, yearrange)
}else{years<-c(years, as.numeric(ex[i]))}
return(unlist(years))
}
years
for (i in 1:(length (ex))){
if (grepl( '-', ex[i], fixed = TRUE)){
x=x+2
startend<-unlist(str_split(ex[i], '-'))
startend<-lapply(startend, as.numeric)
yearrange<-startend[[1]]:startend[[2]]
years<-c(years, yearrange)
}else{
x=x+3
years<-c(years, as.numeric(ex[i]))}
}
x
x<-1
years<-numeric()
x<-1
for (i in 1:(length (ex))){
if (grepl( '-', ex[i], fixed = TRUE)){
x=x+2
startend<-unlist(str_split(ex[i], '-'))
startend<-lapply(startend, as.numeric)
yearrange<-startend[[1]]:startend[[2]]
years<-append(years, yearrange)
}else{
x=x+3
years<-append(years, as.numeric(ex[i]))}
}
years
read_years<-function(ex=step1){
years<-numeric()
for (i in 1:(length (ex))){
if (grepl( '-', ex[i], fixed = TRUE)){
startend<-unlist(str_split(ex[i], '-'))
startend<-lapply(startend, as.numeric)
yearrange<-startend[[1]]:startend[[2]]
years<-append(years, yearrange)
}else{years<-append(years, as.numeric(ex[i]))}
}
return(years)}
read_years(step1)
lapply(exstep1, read_years)
lapply(step1, read_years)
reprotox_atc <- read_csv("~/reprotox_atc.csv")
reprotox_atc
#filter DAPs
SIDIAP<-reprotox_atc["ATC", "SIDIAP_females_only" "SIDIAP_YEARS"]
if(!require(tidyverse)){install.packages("tidyverse")}
suppressPackageStartupMessages(library(tidyverse))
#filter DAPs
SIDIAP<-reprotox_atc%>% pull("ATC", "SIDIAP_females_only", "SIDIAP_YEARS")
SIDIAP
#filter DAPs
SIDIAP<-reprotox_atc%>% pull(ATC, SIDIAP_females_only, SIDIAP_YEARS)
#filter DAPs
SIDIAP<-reprotox_atc[1:3,]
SIDIAP
#filter DAPs
SIDIAP<-reprotox_atc[1:3,][reprotox_atc[2,]==1,]
#filter DAPs
SIDIAP<-reprotox_atc[1:3,][reprotox_atc[2,]==1]
#filter DAPs
SIDIAP<-reprotox_atc[1:3,][,reprotox_atc[2,]==1]
SIDIAP
#filter DAPs
SIDIAP<-reprotox_atc[,1:3][,reprotox_atc[2,]==1]
#filter DAPs
SIDIAP<-reprotox_atc[,1:3][,reprotox_atc[,2]==1]
#filter DAPs
SIDIAP<-reprotox_atc[,1:3]
SIDIAP[SIDIAP$SIDIAP_females_only==1,]
Ferrara<-reprotox_atc[,c(1,4,5)]
Ferrara
Ferrara<-Ferrara[Ferrara$Ferrara_female_only==1,]
Ferrara<-reprotox_atc[,c(1,4,5)]
Ferrara<-Ferrara[Ferrara$Ferrara_female_only==1,]
FISABIO<-reprotox_atc[,c(1,6,7)]
FISABIO<-FISABIO[FISABIO$FISABIO_female_only==1,]
SIDIAP<-SIDIAP[SIDIAP$SIDIAP_females_only==1,]
mydataframes<-list(SIDIAP, Ferrara, FISABIO)
allyears<-list()
for (w in 1:length(mydataframes))
for (w in 1:length(mydataframes)){
#split on commas
dap<-mydataframes[w]
step1<-(str_split(dap[,3], ','))
#now we have a list of lists, where the most complex example is "2011-2016", "2019"
#step 2 get the ranges to individual years
#will need to trasform each row in step 1 to a list
#grepl( needle, haystack, fixed = TRUE)
allyears[w]<-lapply(step1, read_years)
}
for (w in 1:length(mydataframes)){
#split on commas
dap<-mydataframes[w]
step1<-(str_split(dap[,3], ','))
#now we have a list of lists, where the most complex example is "2011-2016", "2019"
#step 2 get the ranges to individual years
#will need to trasform each row in step 1 to a list
#grepl( needle, haystack, fixed = TRUE)
allyears[w]<-lapply(step1, read_years)
}
#great it works :)
mydataframes[1]
#great it works :)
mydataframes[1][3]
#great it works :)
mydataframes[1][,3]
#great it works :)
x<-mydataframes[1]
x
x[,3]
#great it works :)
x<-as.data.frame(mydataframes[1])
x[,3]
for (w in 1:length(mydataframes)){
#split on commas
dap<-as.data.frame(mydataframes[w])
step1<-(str_split(dap[,3], ','))
#now we have a list of lists, where the most complex example is "2011-2016", "2019"
#step 2 get the ranges to individual years
#will need to trasform each row in step 1 to a list
#grepl( needle, haystack, fixed = TRUE)
allyears[w]<-lapply(step1, read_years)
}
#great it works :)
allyears
for (w in 1:length(mydataframes)){
#split on commas
dap<-as.data.frame(mydataframes[w])
step1<-(str_split(dap[,3], ','))
print(step1)
#now we have a list of lists, where the most complex example is "2011-2016", "2019"
#step 2 get the ranges to individual years
#will need to trasform each row in step 1 to a list
#grepl( needle, haystack, fixed = TRUE)
allyears[w]<-lapply(step1, read_years)
}
SID_years<-(str_split(SIDIAP[,3], ','))
SID_years
SIDIAP
FIS_years<-(str_split(FISABIO[,3], ','))
FIS_years
reprotox_atc <- read_csv("~/reprotox_atc.csv")
step1<-(str_split(reprotox_atc$FISABIO_YEARS, ','))
step1
reprotox_atc$FISABIO_YEARS
FISABIO[,3]
FIS_years<-(str_split(list(FISABIO[,3]), ','))
FIS_years
FISABIO<-reprotox_atc[,c(1,6,7)]
FIS_years<-(str_split(FISABIO[,3], ','))
FIS_years
FIS_years<-(str_split(FISABIO$FISABIO_YEARS, ','))
FIS_years
SIDIAP<-reprotox_atc[,1:3]
SIDIAP<-SIDIAP[SIDIAP$SIDIAP_females_only==1,]
SID_years<-(str_split(SIDIAP$SIDIAP_YEARS, ','))
Ferrara<-reprotox_atc[,c(1,4,5)]
Ferrara<-Ferrara[Ferrara$Ferrara_female_only==1,]
Ferrara_years<-(str_split(Ferrara$Ferrara_YEARS, ','))
FISABIO<-reprotox_atc[,c(1,6,7)]
FISABIO<-FISABIO[FISABIO$FISABIO_female_only==1,]
FIS_years<-(str_split(FISABIO$FISABIO_YEARS, ','))
SID_years_read<-lapply(SID_years, read_years)
SID_years_read
newcols<-data.frame()
colnames(newcols)<-c('2015', '2016','2017', '2018', '2019', '2020')
newcols<-data.frame(matrix(ncol = 5, nrow = 0))
colnames(newcols)<-c('2015', '2016','2017', '2018', '2019', '2020')
years<-c('2015', '2016','2017', '2018', '2019', '2020')
colnames(newcols)<-years
newcols<-data.frame(matrix(ncol = 6, nrow = 0))
years<-c('2015', '2016','2017', '2018', '2019', '2020')
colnames(newcols)<-years
merge(SIDIAP, newcols)
merge(SIDIAP, newcols, all.x = T)
merge(SIDIAP, newcols, all = T)
SIDIAP[,4:11]<-years
SIDIAP
SIDIAP[,4:11]<-NA
SIDIAP
colnames(SIDIAP[,4:11])<-years
SIDIAP
years
colnames(SIDIAP[,4:11])
colnames(SIDIAP[,4:11]):=years
colnames(SIDIAP[,4:11])=:years
colnames(SIDIAP[,4:11])=years
SIDIAP
SIDIAP[,4:11]<-newcols
SIDIAP[,4:9]<-newcols
SIDIAP[,4:9]<-NA
colnames(SIDIAP[,4:9])=years
SIDIAP
SIDIAP[,4:9]<-years
SIDIAP
FIS_years_read[1]
SIDIAP<-reprotox_atc[,1:3]
SIDIAP<-SIDIAP[SIDIAP$SIDIAP_females_only==1,]
SID_years<-(str_split(SIDIAP$SIDIAP_YEARS, ','))
SID_years_read<-lapply(SID_years, read_years)
Ferrara<-reprotox_atc[,c(1,4,5)]
Ferrara<-Ferrara[Ferrara$Ferrara_female_only==1,]
Ferrara_years<-(str_split(Ferrara$Ferrara_YEARS, ','))
Ferrara_years_read<-lapply(Ferrara_years, read_years)
FISABIO<-reprotox_atc[,c(1,6,7)]
FISABIO<-FISABIO[FISABIO$FISABIO_female_only==1,]
FIS_years<-(str_split(FISABIO$FISABIO_YEARS, ','))
FIS_years_read<-lapply(FIS_years, read_years)
FIS_years_read[1]
2015%in%FIS_years_read[1]
grepl( 2015, FIS_years[1], fixed = TRUE)
grepl( '2015', FIS_years[1], fixed = TRUE)
FIS_years[1]
grepl( '2015', FIS_years_read[1], fixed = TRUE)
lapply(FIS_years_read, grepl('2015'))
lapply(FIS_years_read, grepl, x='2015')
FIS_years_read
lapply(FIS_years_read, grepl, pattern='2015')
sum(lapply(FIS_years_read, grepl, pattern='2015'))
yearTF<-lapply(FIS_years_read, grepl, pattern='2015')
lapply(yearTF, sum)
unlist(lapply(yearTF, sum))
newcols$2015<-unlist(lapply(yearTF, sum))
newcols$'2015'<-unlist(lapply(yearTF, sum))
newcols[1]<-unlist(lapply(yearTF, sum))
yearschar<-c('2015', '2016','2017', '2018', '2019', '2020')
years<-as.numeric(yearschar)
years
for (i in 1:length(years)){
yearTF<-lapply(FIS_years_read, grepl, pattern=years[i])
FISABIO[,yearschar[i]<-yearTF]
}
FISABIO
unlist(yearTF)
year01<-lappy(yearTF, sum)
year01<-lapply(yearTF, sum)
year01
for (i in 1:length(years)){
yearTF<-lapply(FIS_years_read, grepl, pattern=years[i])
year01<-lapply(yearTF, sum)
FISABIO[,yearschar[i]]<-unlist(year01)
}
for (i in 1:length(years)){
colyear<-yearschar[i]
print(colyear)
yearTF<-lapply(FIS_years_read, grepl, pattern=years[i])
year01<-lapply(yearTF, sum)
FISABIO$colyear<-unlist(year01)
}
yearschar<-c('2015', '2016','2017', '2018', '2019', '2020')
years<-as.numeric(yearschar)
for (i in 1:length(years)){
colyear<-yearschar[i]
print(colyear)
yearTF<-lapply(FIS_years_read, grepl, pattern=years[i])
year01<-lapply(yearTF, sum)
FISABIO$colyear<-unlist(year01)
}
FISABIO
for (i in 1:length(years)){
colyear<-yearschar[i]
print(colyear)
yearTF<-lapply(FIS_years_read, grepl, pattern=years[i])
year01<-lapply(yearTF, sum)
FISABIO[,colyear]<-unlist(year01)
}
FISABIO
View(FISABIO)
#process TPD ATC file
if(!require(stringr)){install.packages("stringr")}
suppressPackageStartupMessages(library(stringr))
if(!require(data.table)){install.packages("data.table")}
suppressPackageStartupMessages(library(data.table))
if(!require(readxl)){install.packages("readxl")}
suppressPackageStartupMessages(library(readxl))
if(!require(tidyverse)){install.packages("tidyverse")}
suppressPackageStartupMessages(library(tidyverse))
#ATC file is not machine readable.
#years stored in a complex string:
#some have ranges: "2015-2017" which need to be --> 2015, 2016, 2017
#others have comma separated: "2015, 2018, 2020" which need to be split
# most complicated, some have combination: '2011-2016, 2019" >_<
read_years<-function(ex=step1){
years<-numeric()
for (i in 1:(length (ex))){
if (grepl( '-', ex[i], fixed = TRUE)){
startend<-unlist(str_split(ex[i], '-'))
startend<-lapply(startend, as.numeric)
yearrange<-startend[[1]]:startend[[2]]
years<-append(years, yearrange)
}else{years<-append(years, as.numeric(ex[i]))}
}
return(years)}
#start converting data
reprotox_atc <- read_csv("~/reprotox_atc.csv")
#filter DAPs
SIDIAP<-reprotox_atc[,1:3]
SIDIAP<-SIDIAP[SIDIAP$SIDIAP_females_only==1,]
SID_years<-(str_split(SIDIAP$SIDIAP_YEARS, ','))
SID_years_read<-lapply(SID_years, read_years)
Ferrara<-reprotox_atc[,c(1,4,5)]
Ferrara<-Ferrara[Ferrara$Ferrara_female_only==1,]
Ferrara_years<-(str_split(Ferrara$Ferrara_YEARS, ','))
Ferrara_years_read<-lapply(Ferrara_years, read_years)
FISABIO<-reprotox_atc[,c(1,6,7)]
FISABIO<-FISABIO[FISABIO$FISABIO_female_only==1,]
FIS_years<-(str_split(FISABIO$FISABIO_YEARS, ','))
FIS_years_read<-lapply(FIS_years, read_years)
#now I have each DAP and the each year extracted
#next need column per year, then 0 or 1 if the year is indicated--> voila, machine readable
yearschar<-c('2015', '2016','2017', '2018', '2019', '2020')
years<-as.numeric(yearschar)
for (i in 1:length(years)){
colyear<-yearschar[i]
print(colyear)
yearTF<-lapply(FIS_years_read, grepl, pattern=years[i])
year01<-lapply(yearTF, sum)
FISABIO[,colyear]<-unlist(year01)
}
for (i in 1:length(years)){
colyear<-yearschar[i]
print(colyear)
yearTF<-lapply(Ferrara_years_read, grepl, pattern=years[i])
year01<-lapply(yearTF, sum)
Ferrara[,colyear]<-unlist(year01)
}
for (i in 1:length(years)){
colyear<-yearschar[i]
print(colyear)
yearTF<-lapply(SID_years_read, grepl, pattern=years[i])
year01<-lapply(yearTF, sum)
SIDIAP[,colyear]<-unlist(year01)
}
View(Ferrara)
fwrite(SIDIAP, '~/SIDIAP_ATC.csv')
fwrite(FISABIO, '~/FISABIO_ATC.csv')
fwrite(Ferrara, '~/Ferrara_ATC.csv')
