#create truncated code
df[,truncated_code:=substr(code_no_dot,1,length)]
df<-merge.data.table(df,codes[codes_ind,],by=c("event_vocabulary","truncated_code"),all.x = T,allow.cartesian = T)
if(df[prior_gdm_pe==0 & after_gdm_pe==0 & filter==1 & is.na(remove),.N]>0){
years_this_event<-sort(df[prior_gdm_pe==0 & after_gdm_pe==0 & filter==1 & is.na(remove)][!duplicated(year),year])
for(year_ind in 1:length(years_this_event)){
saveRDS(data.table(df[prior_gdm_pe==0 & after_gdm_pe==0 & is.na(remove) & filter==1 & year==years_this_event[year_ind]], condition=names(conditions_gdm[i])), paste0(tmp,years_this_event[year_ind],"_","GDMcat_", names(conditions_gdm[i]), "_",actual_tables$SURVEY_OBSERVATIONS[y],"_", codes_ind, ".rds"))
}
} else {
years_this_event<-NULL}# new 01.06.2022
rm(years_this_event)
rm(length)
if("filter" %in% names(df)){df[,filter:=NULL]}
if("truncated_code" %in% names(df)){df[,truncated_code:=NULL]}
}
rm(codes)
}
}
}
}
if(so_pe_diagnoses_cat>0){
print(paste0("Filtering data for PE diagnoses category:", actual_tables$SURVEY_OBSERVATIONS[y]))
years_study_events<-sort(df[prior_gdm_pe==0 & after_gdm_pe==0 & is.na(remove)][!duplicated(year), year])#years present in this table
if(sum(df[prior_gdm_pe==0 & after_gdm_pe==0 & is.na(remove)][!duplicated(event_vocabulary), event_vocabulary] %in% vocabularies_list_pe)>0){
for (i in 1:length(conditions_pe)){
for(j in 1:length(conditions_pe[[i]])){
codes<-data.table(event_vocabulary=names(conditions_pe[[i]])[j], truncated_code=conditions_pe[[i]][[j]], filter=1)
for(codes_ind in 1:codes[,.N]){
length<-nchar(codes[codes_ind,truncated_code])
#create truncated code
df[,truncated_code:=substr(code_no_dot,1,length)]
df<-merge.data.table(df,codes[codes_ind,],by=c("event_vocabulary","truncated_code"),all.x = T,allow.cartesian = T)
if(df[prior_gdm_pe==0 & after_gdm_pe==0 & filter==1 & is.na(remove),.N]>0){
years_this_event<-sort(df[prior_gdm_pe==0 & after_gdm_pe==0 & filter==1 & is.na(remove)][!duplicated(year),year])
for(year_ind in 1:length(years_this_event)){
saveRDS(data.table(df[prior_gdm_pe==0 & after_gdm_pe==0 & is.na(remove) & filter==1 & year==years_this_event[year_ind]], condition=names(conditions_pe[i])), paste0(tmp,years_this_event[year_ind],"_","PEcat_", names(conditions_pe[i]), "_",actual_tables$SURVEY_OBSERVATIONS[y],"_", codes_ind, ".rds"))
}
} else {
years_this_event<-NULL}# new 01.06.2022
rm(years_this_event)
rm(length)
if("filter" %in% names(df)){df[,filter:=NULL]}
if("truncated_code" %in% names(df)){df[,truncated_code:=NULL]}
}
rm(codes)
}
}
}
}
}
if(df[prior_mig==0 & after_mig==0 & is.na(remove),.N]>0){
if(so_migraine_diagnoses_cat>0){
vocabularies_to_start_with<-c("ICD", "ICPC", "RCD")
print(paste0("Filtering data for Migraine diagnoses category:", actual_tables$SURVEY_OBSERVATIONS[y]))
years_study_events<-sort(df[prior_mig==0 & after_mig==0 & is.na(remove)][!duplicated(year), year])#years present in this table
#startWith for the event Migraine
if(sum(sapply(vocabularies_to_start_with, function(start) any(startsWith(df[prior_mig==0 & after_mig==0][!duplicated(event_vocabulary), event_vocabulary], start))))>=1){
if(sum(df[prior_mig==0 & after_mig==0 & is.na(remove)][!duplicated(event_vocabulary), event_vocabulary] %in% vocabularies_list_migraine)>0){
for (i in 1:length(conditions_migraine)){
for(j in 1:length(conditions_migraine[[i]])){
codes<-data.table(event_vocabulary=names(conditions_migraine[[i]])[j], truncated_code=conditions_migraine[[i]][[j]], filter=1)
for(codes_ind in 1:codes[,.N]){
length<-nchar(codes[codes_ind,truncated_code])
#create truncated code
df[,truncated_code:=substr(code_no_dot,1,length)]
df<-merge.data.table(df,codes[codes_ind,],by=c("event_vocabulary","truncated_code"),all.x = T,allow.cartesian = T)
if(df[prior_mig==0 & after_mig==0 & filter==1 & is.na(remove),.N]>0){
years_this_event<-sort(df[prior_mig==0 & after_mig==0 & filter==1 & is.na(remove)][!duplicated(year),year])
for(year_ind in 1:length(years_this_event)){
saveRDS(data.table(df[prior_mig==0 & after_mig==0 & filter==1 & is.na(remove) & year==years_this_event[year_ind]], condition=names(conditions_migraine[i])), paste0(tmp,years_this_event[year_ind],"_","Migrainecat_", names(conditions_migraine[i]), "_",actual_tables$SURVEY_OBSERVATIONS[y],"_", codes_ind, ".rds"))
}
} else {
years_this_event<-NULL}# new 01.06.2022
rm(years_this_event)
rm(length)
if("filter" %in% names(df)){df[,filter:=NULL]}
if("truncated_code" %in% names(df)){df[,truncated_code:=NULL]}
}
rm(codes)
}
}
}
}
#exact match for the other events related to migraine
if(sum(sapply(vocabularies_to_start_with, function(start) any(startsWith(df[prior_mig==0 & after_mig==0][!duplicated(event_vocabulary), event_vocabulary], start))))==0){
if(sum(df[prior_mig==0 & after_mig==0 & is.na(remove)][!duplicated(event_vocabulary), event_vocabulary] %in% vocabularies_list_migraine)>0){
for (i in 1:length(conditions_migraine)){
for(j in 1:length(conditions_migraine[[i]])){
codes<-data.table(event_vocabulary=names(conditions_migraine[[i]])[j], code_no_dot=conditions_migraine[[i]][[j]], filter=1)
for(codes_ind in 1:codes[,.N]){
#create truncated code
df<-merge.data.table(df,codes[codes_ind,],by=c("event_vocabulary","code_no_dot"),all.x = T,allow.cartesian = T)
if(df[prior_mig==0 & after_mig==0 & filter==1 & is.na(remove),.N]>0){
years_this_event<-sort(df[prior_mig==0 & after_mig==0 & filter==1 & is.na(remove)][!duplicated(year),year])
for(year_ind in 1:length(years_this_event)){
saveRDS(data.table(df[prior_mig==0 & after_mig==0 & filter==1 & is.na(remove) & year==years_this_event[year_ind]], condition=names(conditions_migraine[i])), paste0(tmp,years_this_event[year_ind],"_","Migrainecat_", names(conditions_migraine[i]), "_",actual_tables$SURVEY_OBSERVATIONS[y],"_", codes_ind, ".rds"))
}
} else {
years_this_event<-NULL}# new 01.06.2022
rm(years_this_event)
if("filter" %in% names(df)){df[,filter:=NULL]}
}
rm(codes)
}
}
}
}
}
}
}
####Diagnoses category####
#Gather information about not fixed values/Not needed at the moment
# if(sum(!is.null(diag_cat_gdm),!is.null(diag_cat_pe), !is.null(diag_cat_migraine))>0){
#   #Diagnoses category GDM&PE
#   if(!is.null(diag_cat_gdm)){
#     if(df[prior_gdm_pe==0 & after_gdm_pe==0,.N]>0){
#       print(paste0("Filtering data for GDM diagnoses category:", actual_tables$SURVEY_OBSERVATIONS[y]))
#       gdm_diag_cat_so<-gdm_diag_cat[table=="SURVEY_OBSERVATIONS"]
#       if(gdm_diag_cat_so[,.N]>0){
#         names_df<-names(df)
#         same_names<-intersect(names_df,names(gdm_diag_cat_so))
#         df<-merge.data.table(df,diag_cat_gdm,by=same_names,all.x=T)
#         if(df[prior_gdm_pe==0 & after_gdm_pe==0 & !is.na(event_abbreviation),.N]>0){
#           for(cat_ind in 1:gdm_diag_cat_so[,.N]){
#             cols_to_keep<-c(gdm_diag_cat_so[cat_ind==index,date_column],gdm_diag_cat_so[cat_ind==index,keep])
#             #rename columns
#             setnames(df,gdm_diag_cat_so[cat_ind==index,date_column], "event_date")
#             setnames(df,gdm_diag_cat_so[cat_ind==index,keep], "event_code")
#             setnames(df, "so_meaning", "meaning")
#             setnames(df, "event_abbreviation", "condition")
#
#             #date variable
#             df[,event_date:=as.IDate(event_date, "%Y%m%d")]
#             if(!"year" %in% names(df)){df[,year:=year(event_date)]}
#
#             cols_to_keep<-c("event_date","event_code", "person_id","meaning","condition","year")
#             years_cat<-sort(df[prior_gdm_pe==0 & after_gdm_pe==0 & !is.na(condition) & index==cat_ind][!duplicated(year),year])
#             for(year_ind in 1:length(years_cat)){
#               saveRDS(df[prior_gdm_pe==0 & after_gdm_pe==0 &!is.na(condition)][year==years_cat[year_ind] & index==cat_ind, cols_to_keep, with=F], paste0(projectFolder,"/g_intermediate/tmp/", years_cat[year_ind],"_", "GDM_diagnoses_cat_so",cat_ind,".rds"))
#             }# new 01.06.2022
#
#             rm(years_cat,year_ind)
#
#             #rename columns
#             setnames(df, "event_date", gdm_diag_cat_so[cat_ind==index,date_column])
#             setnames(df,"event_code", gdm_diag_cat_so[cat_ind==index,keep])
#             setnames(df, "meaning", "so_meaning")
#             setnames(df, "condition", "event_abbreviation")
#
#           }
#           df[,table:=NULL][,event_abbreviation:=NULL][,keep:=NULL][,index:=NULL]
#         }
#       }
#     }
#   }
#   #Diagnoses category PE
#   if(!is.null(diag_cat_pe)){
#     print(paste0("Filtering data for PE diagnoses category:", actual_tables$SURVEY_OBSERVATIONS[y]))
#     pe_diag_cat_so<-pe_diag_cat[table=="SURVEY_OBSERVATIONS"]
#     if(pe_diag_cat_so[,.N]>0){
#       names_df<-names(df)
#       same_names<-intersect(names_df,names(pe_diag_cat_so))
#       df<-merge.data.table(df,diag_cat_pe,by=same_names,all.x=T)
#       if(df[prior_gdm_pe==0 & after_gdm_pe==0 & !is.na(event_abbreviation),.N]>0){
#         for(cat_ind in 1:pe_diag_cat_so[,.N]){
#           cols_to_keep<-c(pe_diag_cat_so[cat_ind==index,date_column],pe_diag_cat_so[cat_ind==index,keep])
#           #rename columns
#           setnames(df,pe_diag_cat_so[cat_ind==index,date_column], "event_date")
#           setnames(df,pe_diag_cat_so[cat_ind==index,keep], "event_code")
#           setnames(df, "so_meaning", "meaning")
#           setnames(df, "event_abbreviation", "condition")
#
#           #date variable
#           df[,event_date:=as.IDate(event_date, "%Y%m%d")]
#           if(!"year" %in% names(df)){df[,year:=year(event_date)]}
#
#           cols_to_keep<-c("event_date","event_code", "person_id","meaning","condition","year")
#
#           years_cat<-sort(df[prior_gdm_pe==0 & after_gdm_pe==0 & !is.na(condition) & index==cat_ind][!duplicated(year),year])
#           for(year_ind in 1:length(years_cat)){
#             saveRDS(df[prior_gdm_pe==0 & after_gdm_pe==0 &!is.na(condition)][year==years_cat[year_ind] & index==cat_ind, cols_to_keep, with=F], paste0(projectFolder,"/g_intermediate/tmp/", years_cat[year_ind],"_", "PE_diagnoses_cat_so",cat_ind,".rds"))
#           }# new 01.06.2022
#
#           rm(years_cat,year_ind)
#
#           #rename columns
#           setnames(df, "event_date", pe_diag_cat_so[cat_ind==index,date_column])
#           setnames(df,"event_code", pe_diag_cat_so[cat_ind==index,keep])
#           setnames(df, "meaning", "so_meaning")
#           setnames(df, "condition", "event_abbreviation")
#
#         }
#         df[,table:=NULL][,event_abbreviation:=NULL][,keep:=NULL][,index:=NULL]
#       }
#     }
#   }
#   #Migraine
#   if(!is.null(diag_cat_migraine)){
#     if(df[prior_mig==0 & after_mig==0,.N]>0){
#       print(paste0("Filtering data for Migraine diagnoses category:", actual_tables$SURVEY_OBSERVATIONS[y]))
#       migraine_diag_cat_so<-migraine_diag_cat[table=="SURVEY_OBSERVATIONS"]
#       if(migraine_diag_cat_so[,.N]>0){
#         names_df<-names(df)
#         same_names<-intersect(names_df,names(migraine_diag_cat_so))
#         df<-merge.data.table(df,diag_cat_migraine,by=same_names,all.x=T)
#         if(df[prior_mig==0 & after_mig==0 & !is.na(event_abbreviation),.N]>0){
#           for(cat_ind in 1:migraine_diag_cat_so[,.N]){
#             cols_to_keep<-c(migraine_diag_cat_so[cat_ind==index,date_column],migraine_diag_cat_so[cat_ind==index,keep])
#             #rename columns
#             setnames(df,migraine_diag_cat_so[cat_ind==index,date_column], "event_date")
#             setnames(df,migraine_diag_cat_so[cat_ind==index,keep], "event_code")
#             setnames(df, "so_meaning", "meaning")
#             setnames(df, "event_abbreviation", "condition")
#
#             #date variable
#             df[,event_date:=as.IDate(event_date, "%Y%m%d")]
#             if(!"year" %in% names(df)){df[,year:=year(event_date)]}
#
#             cols_to_keep<-c("event_date","event_code", "person_id","meaning","condition","year")
#             years_cat<-sort(df[prior_mig==0 & after_mig==0 & !is.na(condition) & index==cat_ind][!duplicated(year),year])
#             for(year_ind in 1:length(years_cat)){
#               saveRDS(df[prior_mig==0 & after_mig==0 & !is.na(condition)][year==years_cat[year_ind] & index==cat_ind, cols_to_keep, with=F], paste0(projectFolder,"/g_intermediate/tmp/", years_cat[year_ind],"_", "Migraine_diagnoses_cat_so",cat_ind,".rds"))
#             }# new 01.06.2022
#
#             rm(years_cat,year_ind)
#
#             #rename columns
#             setnames(df, "event_date", migraine_diag_cat_so[cat_ind==index,date_column])
#             setnames(df,"event_code", migraine_diag_cat_so[cat_ind==index,keep])
#             setnames(df, "meaning", "so_meaning")
#             setnames(df, "condition", "event_abbreviation")
#
#           }
#           df[,table:=NULL][,event_abbreviation:=NULL][,keep:=NULL][,index:=NULL]
#         }
#       }
#     }
#   }
# }
setnames(df,"event_date",date_var_2)
setnames(df, "event_code",code_var_2)
setnames(df, "event_vocabulary",voc_var_2)
setnames(df,"meaning", "so_meaning")
df[,remove:=NULL][,year:=NULL][,prior_gdm_pe:=NULL][,prior_mig:=NULL][,prior_du:=NULL][,prior_saf:=NULL][,after_gdm_pe:=NULL][,after_mig:=NULL][,after_du:=NULL][,after_saf:=NULL][,code_no_dot:=NULL]
####Checkbox information####
#Change name back
setnames(df,"event_date",date_var_2)
setnames(df, "event_code",code_var_2)
setnames(df, "event_vocabulary",voc_var_2)
setnames(df,"meaning", "so_meaning")
df[,remove:=NULL][,year:=NULL][,prior_gdm_pe:=NULL][,prior_mig:=NULL][,prior_du:=NULL][,prior_saf:=NULL][,after_gdm_pe:=NULL][,after_mig:=NULL][,after_du:=NULL][,after_saf:=NULL][,code_no_dot:=NULL]
#GDM
if(!is.null(diag_checkbox_gdm_so)){
if(df[,.N]>0){
print(paste0("Filtering data for GDM checkbox:", actual_tables$SURVEY_OBSERVATIONS[y]))
gdm_diag_checkbox_so<-diag_checkbox_gdm_so[table=="SURVEY_OBSERVATIONS"]
if(gdm_diag_checkbox_so[,.N]>0){
names_df<-names(df)
same_names<-as.character(intersect(names_df,names(gdm_diag_checkbox_so)))
df<-merge.data.table(df,gdm_diag_checkbox_so,by=same_names,all.x=T)
if(df[!is.na(event_abbreviation),.N]>0){
for(cat_ind in 1:gdm_diag_checkbox_so[!duplicated(index),.N]){
cols_to_keep<-c(unique(gdm_diag_checkbox_so[cat_ind==index,checkbox_date]),unique(gdm_diag_checkbox_so[cat_ind==index,keep]))
#rename columns
setnames(df,unique(gdm_diag_checkbox_so[cat_ind==index,checkbox_date]), "event_date")
setnames(df,unique(gdm_diag_checkbox_so[cat_ind==index,keep]), "event_code")
setnames(df, "so_meaning", "meaning")
setnames(df, "event_abbreviation", "condition")
#date variable
df[,event_date:=as.IDate(event_date, "%Y%m%d")]
df[,prior_gdm_pe:=ifelse(gdm_pe_start_study_date>event_date,1,0)]
df[,after_gdm_pe:=ifelse(gdm_pe_end_study_date<event_date,1,0)]
if(!"year" %in% names(df)){df[,year:=year(event_date)]}
df[prior_gdm_pe==0 & after_gdm_pe==0 & !is.na(condition),include:=1]
df[,prior_gdm_pe:=NULL][,after_gdm_pe:=NULL]
if(df[include==1 & index==cat_ind,.N]>0){
cols_to_keep<-c("event_date","event_code", "person_id","meaning","condition","year")
years_cat<-sort(df[include==1 & index==cat_ind][!duplicated(year),year])
for(year_ind in 1:length(years_cat)){
saveRDS(df[include==1 & !is.na(condition)][year==years_cat[year_ind] & index==cat_ind, cols_to_keep, with=F], paste0(projectFolder,"/g_intermediate/tmp/", years_cat[year_ind],"_", "GDM_diagnoses_checkbox_so",cat_ind,".rds"))
}# new 01.06.2022
}
if("years_cat" %in% ls()){rm(years_cat)}
if("year_ind" %in% ls()){rm(year_ind)}
#rename columns
setnames(df, "event_date", unique(gdm_diag_checkbox_so[cat_ind==index,checkbox_date]))
setnames(df,"event_code", unique(gdm_diag_checkbox_so[cat_ind==index,keep]))
setnames(df, "meaning", "so_meaning")
setnames(df, "condition", "event_abbreviation")
}
df[,table:=NULL][,event_abbreviation:=NULL][,keep:=NULL][,index:=NULL]
}
}
}
}
#remove uneccessary variables
if("checkbox_date" %in% names(df)){df[,checkbox_date:=NULL]}
if("include" %in% names(df)){df[,include:=NULL]}
if("year" %in% names(df)){df[,year:=NULL]}
#PE
if(!is.null(diag_checkbox_pe_so)){
if(df[,.N]>0){
print(paste0("Filtering data for PE checkbox:", actual_tables$SURVEY_OBSERVATIONS[y]))
pe_diag_checkbox_so<-diag_checkbox_pe_so[table=="SURVEY_OBSERVATIONS"]
if(pe_diag_checkbox_so[,.N]>0){
names_df<-names(df)
same_names<-intersect(names_df,names(pe_diag_checkbox_so))
df<-merge.data.table(df,pe_diag_checkbox_so,by=same_names,all.x=T)
if(df[!is.na(event_abbreviation),.N]>0){
for(cat_ind in 1:pe_diag_checkbox_so[!duplicated(index),.N]){
cols_to_keep<-c(unique(pe_diag_checkbox_so[cat_ind==index,checkbox_date]),unique(pe_diag_checkbox_so[cat_ind==index,keep]))
#rename columns
setnames(df,unique(pe_diag_checkbox_so[cat_ind==index,checkbox_date]), "event_date")
setnames(df,unique(pe_diag_checkbox_so[cat_ind==index,keep]), "event_code")
setnames(df, "so_meaning", "meaning")
setnames(df, "event_abbreviation", "condition")
#date variable
df[,event_date:=as.IDate(event_date, "%Y%m%d")]
df[,prior_gdm_pe:=ifelse(gdm_pe_start_study_date>event_date,1,0)]
df[,after_gdm_pe:=ifelse(gdm_pe_end_study_date<event_date,1,0)]
if(!"year" %in% names(df)){df[,year:=year(event_date)]}
df[prior_gdm_pe==0 & after_gdm_pe==0 & !is.na(condition),include:=1]
df[,prior_gdm_pe:=NULL][,after_gdm_pe:=NULL]
if(df[include==1 & index==cat_ind,.N]>0){
cols_to_keep<-c("event_date","event_code", "person_id","meaning","condition","year")
years_cat<-sort(df[include==1 & !is.na(condition) & index==cat_ind][!duplicated(year),year])
for(year_ind in 1:length(years_cat)){
saveRDS(df[include==1 & !is.na(condition)][year==years_cat[year_ind] & index==cat_ind, cols_to_keep, with=F], paste0(projectFolder,"/g_intermediate/tmp/", years_cat[year_ind],"_", "PE_diagnoses_checkbox_so",cat_ind,".rds"))
}# new 01.06.2022
}
if("years_cat" %in% ls()){rm(years_cat)}
if("year_ind" %in% ls()){rm(year_ind)}
#rename columns
setnames(df, "event_date", unique(pe_diag_checkbox_so[cat_ind==index,checkbox_date]))
setnames(df,"event_code", unique(pe_diag_checkbox_so[cat_ind==index,keep]))
setnames(df, "meaning", "so_meaning")
setnames(df, "condition", "event_abbreviation")
#remove columns
if("checkbox_date" %in% names(df)){df[,checkbox_date:=NULL]}
}
df[,table:=NULL][,event_abbreviation:=NULL][,keep:=NULL][,index:=NULL]
}
}
}
}
#close the loop after removing not present subjects and uneccessary dates
}
#close the loop use for filtering
}
#close the loop
}
y<-1
diag_checkbox_gdm_so
View(df)
#recopy columns
df[,event_code:=get(unique(gdm_diag_checkbox_so[cat_ind==index,checkbox_date]))]
cat_ind<-1
#recopy columns
df[,event_date:=get(unique(gdm_diag_checkbox_so[cat_ind==index,checkbox_date]))]
View(df)
df[,event_code:=get(unique(gdm_diag_checkbox_so[cat_ind==index,keep]))]
View(df)
####SO####
source(paste0(pre_dir,"Step_02_c_diagnoses_clean_up_so.R"))
####SO####
source(paste0(pre_dir,"Step_02_c_diagnoses_clean_up_so.R"))
####SO####
source(paste0(pre_dir,"Step_02_c_diagnoses_clean_up_so.R"))
####Clean pregnancies####
rm(list=ls())
if(!require(rstudioapi)){install.packages("rstudioapi")}
library(rstudioapi)
projectFolder<-dirname(rstudioapi::getSourceEditorContext()$path)
setwd(projectFolder)
source("packages.R")
source(paste0(projectFolder,"/p_steps/clean_folders.R"))
source("99_path.R")
setwd(projectFolder)
#Run pregnancy algorithm and save results in g_intermediate/pregnancy_algorithm
source(paste0(pre_dir,"Step_00_create_clean_pregnancy_D3.R"))
render(paste0(pre_dir,"Report_0_pregnancy_algorithm_flowchart.Rmd"), output_dir = output_dir, output_file = paste0(format(Sys.Date(), "%Y"),format(Sys.Date(), "%m"),format(Sys.Date(), "%d"),"_",data_access_provider_name,"_", "Report_0_Pregnancy_algorithm_flowchart.html"))
source(paste0(pre_dir,"save_environment.R"))
####Create pregnancy study population####
rm(list=ls())
if(!require(rstudioapi)){install.packages("rstudioapi")}
library(rstudioapi)
projectFolder<-dirname(rstudioapi::getSourceEditorContext()$path)
setwd(projectFolder)
source("packages.R")
source("99_path.R")
setwd(projectFolder)
#Create study population(persons/observation_periods/pregnancies)
load(paste0(g_intermediate,"environment.RData"))
source(paste0(pre_dir,"Step_01_create_study_population.R"))
render(paste0(pre_dir,"Report_1_pregnancy_study_population.Rmd"), output_dir = output_dir, output_file = paste0(format(Sys.Date(), "%Y"),format(Sys.Date(), "%m"),format(Sys.Date(), "%d"),"_",data_access_provider_name,"_", "Report_1_Pregnancy_study_population.html"))
source(paste0(pre_dir,"save_environment.R"))
####Run diagnostic filtering script####
rm(list=ls())
if(!require(rstudioapi)){install.packages("rstudioapi")}
library(rstudioapi)
projectFolder<-dirname(rstudioapi::getSourceEditorContext()$path)
setwd(projectFolder)
source("packages.R")
source("99_path.R")
setwd(projectFolder)
#Create diagnoses D3(GDM/PE/Migraine)
load(paste0(g_intermediate,"environment.RData"))
source(paste0(pre_dir,"Step_02_diagnoses_clean_up.R"))
source(paste0(pre_dir,"Step_02_diagnoses_clean_up_combine.R"))
render(paste0(pre_dir,"Report_2_diagnoses_clean_up.Rmd"), output_dir = output_dir, output_file = paste0(format(Sys.Date(), "%Y"),format(Sys.Date(), "%m"),format(Sys.Date(), "%d"),"_",data_access_provider_name,"_", "Report_2_Diagnoses_clean_up.html"))
source(paste0(pre_dir,"save_environment.R"))
####Run medicines filtering script####
rm(list=ls())
if(!require(rstudioapi)){install.packages("rstudioapi")}
library(rstudioapi)
projectFolder<-dirname(rstudioapi::getSourceEditorContext()$path)
setwd(projectFolder)
source("packages.R")
source("99_path.R")
setwd(projectFolder)
#Create medicines D3(GDM/PE/Migraine)
load(paste0(g_intermediate,"environment.RData"))
source(paste0(pre_dir,"Step_03_medicines_clean_up.R"))
source(paste0(pre_dir,"Step_03_medicines_clean_up_combine.R"))
render(paste0(pre_dir,"Report_3_medicines_clean_up.Rmd"), output_dir = output_dir, output_file = paste0(format(Sys.Date(), "%Y"),format(Sys.Date(), "%m"),format(Sys.Date(), "%d"),"_",data_access_provider_name,"_", "Report_3_Medicines_clean_up.html"))
source(paste0(pre_dir,"save_environment.R"))
####Create algorithms for GDM/PE/Migraine####
rm(list=ls())
if(!require(rstudioapi)){install.packages("rstudioapi")}
library(rstudioapi)
projectFolder<-dirname(rstudioapi::getSourceEditorContext()$path)
setwd(projectFolder)
source("packages.R")
source("99_path.R")
setwd(projectFolder)
load(paste0(g_intermediate,"environment.RData"))
source(paste0(pre_dir,"Step_04_algorithms.R"))
render(paste0(pre_dir,"Report_4_gdm_pe_algorithms.Rmd"), output_dir = output_dir, output_file = paste0(format(Sys.Date(), "%Y"),format(Sys.Date(), "%m"),format(Sys.Date(), "%d"),"_",data_access_provider_name,"_", "Report_4_gdm_pe_algorithms.html"))
render(paste0(pre_dir,"Report_4_migraine_algorithms.Rmd"), output_dir = output_dir, output_file = paste0(format(Sys.Date(), "%Y"),format(Sys.Date(), "%m"),format(Sys.Date(), "%d"),"_",data_access_provider_name,"_", "Report_4_migraine_algorithms.html"))
source(paste0(pre_dir,"save_environment.R"))
####Clean pregnancies####
rm(list=ls())
if(!require(rstudioapi)){install.packages("rstudioapi")}
library(rstudioapi)
projectFolder<-dirname(rstudioapi::getSourceEditorContext()$path)
setwd(projectFolder)
source("packages.R")
source(paste0(projectFolder,"/p_steps/clean_folders.R"))
source("99_path.R")
setwd(projectFolder)
#Run pregnancy algorithm and save results in g_intermediate/pregnancy_algorithm
source(paste0(pre_dir,"Step_00_create_clean_pregnancy_D3.R"))
render(paste0(pre_dir,"Report_0_pregnancy_algorithm_flowchart.Rmd"), output_dir = output_dir, output_file = paste0(format(Sys.Date(), "%Y"),format(Sys.Date(), "%m"),format(Sys.Date(), "%d"),"_",data_access_provider_name,"_", "Report_0_Pregnancy_algorithm_flowchart.html"))
source(paste0(pre_dir,"save_environment.R"))
####Create pregnancy study population####
rm(list=ls())
if(!require(rstudioapi)){install.packages("rstudioapi")}
library(rstudioapi)
projectFolder<-dirname(rstudioapi::getSourceEditorContext()$path)
setwd(projectFolder)
source("packages.R")
source("99_path.R")
setwd(projectFolder)
#Create study population(persons/observation_periods/pregnancies)
load(paste0(g_intermediate,"environment.RData"))
source(paste0(pre_dir,"Step_01_create_study_population.R"))
render(paste0(pre_dir,"Report_1_pregnancy_study_population.Rmd"), output_dir = output_dir, output_file = paste0(format(Sys.Date(), "%Y"),format(Sys.Date(), "%m"),format(Sys.Date(), "%d"),"_",data_access_provider_name,"_", "Report_1_Pregnancy_study_population.html"))
source(paste0(pre_dir,"save_environment.R"))
####Run diagnostic filtering script####
rm(list=ls())
if(!require(rstudioapi)){install.packages("rstudioapi")}
library(rstudioapi)
projectFolder<-dirname(rstudioapi::getSourceEditorContext()$path)
setwd(projectFolder)
source("packages.R")
source("99_path.R")
setwd(projectFolder)
#Create diagnoses D3(GDM/PE/Migraine)
load(paste0(g_intermediate,"environment.RData"))
source(paste0(pre_dir,"Step_02_diagnoses_clean_up.R"))
source(paste0(pre_dir,"Step_02_diagnoses_clean_up_combine.R"))
render(paste0(pre_dir,"Report_2_diagnoses_clean_up.Rmd"), output_dir = output_dir, output_file = paste0(format(Sys.Date(), "%Y"),format(Sys.Date(), "%m"),format(Sys.Date(), "%d"),"_",data_access_provider_name,"_", "Report_2_Diagnoses_clean_up.html"))
source(paste0(pre_dir,"save_environment.R"))
####Run medicines filtering script####
rm(list=ls())
if(!require(rstudioapi)){install.packages("rstudioapi")}
library(rstudioapi)
projectFolder<-dirname(rstudioapi::getSourceEditorContext()$path)
setwd(projectFolder)
source("packages.R")
source("99_path.R")
setwd(projectFolder)
#Create medicines D3(GDM/PE/Migraine)
load(paste0(g_intermediate,"environment.RData"))
source(paste0(pre_dir,"Step_03_medicines_clean_up.R"))
source(paste0(pre_dir,"Step_03_medicines_clean_up_combine.R"))
render(paste0(pre_dir,"Report_3_medicines_clean_up.Rmd"), output_dir = output_dir, output_file = paste0(format(Sys.Date(), "%Y"),format(Sys.Date(), "%m"),format(Sys.Date(), "%d"),"_",data_access_provider_name,"_", "Report_3_Medicines_clean_up.html"))
source(paste0(pre_dir,"save_environment.R"))
####Create algorithms for GDM/PE/Migraine####
rm(list=ls())
if(!require(rstudioapi)){install.packages("rstudioapi")}
library(rstudioapi)
projectFolder<-dirname(rstudioapi::getSourceEditorContext()$path)
setwd(projectFolder)
source("packages.R")
source("99_path.R")
setwd(projectFolder)
load(paste0(g_intermediate,"environment.RData"))
source(paste0(pre_dir,"Step_04_algorithms.R"))
render(paste0(pre_dir,"Report_4_gdm_pe_algorithms.Rmd"), output_dir = output_dir, output_file = paste0(format(Sys.Date(), "%Y"),format(Sys.Date(), "%m"),format(Sys.Date(), "%d"),"_",data_access_provider_name,"_", "Report_4_gdm_pe_algorithms.html"))
render(paste0(pre_dir,"Report_4_migraine_algorithms.Rmd"), output_dir = output_dir, output_file = paste0(format(Sys.Date(), "%Y"),format(Sys.Date(), "%m"),format(Sys.Date(), "%d"),"_",data_access_provider_name,"_", "Report_4_migraine_algorithms.html"))
source(paste0(pre_dir,"save_environment.R"))
